{% extends "layouts/base.html" %} {% block title %}Roles Management{% endblock
%} {% block content %}
<div class="mb-4">
  <h1 class="h2" style="font-weight: 700; color: var(--text-primary)">
    <i class="fas fa-user-shield me-2"></i>Roles Management
  </h1>
  <p style="color: var(--text-secondary); font-size: 0.95rem">
    Manage user roles and permissions
  </p>
</div>

<div class="row">
  {% for role in roles %}
  <div class="col-md-4 mb-4">
    <div class="card" style="height: 100%">
      <div
        class="card-header"
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
        "
      >
        <div>
          <i class="fas fa-shield-alt me-2"></i>{{ role.display_name }}
          <span class="badge bg-{{ role.badge_color }} ms-2"
            >{{ role.name|upper }}</span
          >
        </div>
        <span class="badge bg-secondary"
          >{{ role.user_count }} user{% if role.user_count != 1 %}s{% endif
          %}</span
        >
      </div>
      <div class="card-body">
        <p
          style="
            color: var(--text-secondary);
            margin-bottom: 16px;
            font-size: 0.9rem;
          "
        >
          {{ role.description }}
        </p>

        <h6
          style="
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 0.85rem;
          "
        >
          <i class="fas fa-key me-2"></i>PERMISSIONS ({{ role.permissions|length
          }})
        </h6>
        <ul style="padding-left: 20px; margin-bottom: 20px">
          {% for permission in role.permissions %}
          <li
            style="
              color: var(--text-secondary);
              font-size: 0.85rem;
              margin-bottom: 6px;
            "
          >
            <i
              class="fas fa-check text-success me-2"
              style="font-size: 0.7rem"
            ></i
            >{{ permission }}
          </li>
          {% endfor %}
        </ul>

        {% if role.users %}
        <h6
          style="
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 12px;
            font-size: 0.85rem;
          "
        >
          <i class="fas fa-users me-2"></i>USERS
        </h6>
        <div style="max-height: 150px; overflow-y: auto">
          {% for user in role.users %}
          <div
            style="padding: 6px 0; border-bottom: 1px solid var(--card-border)"
          >
            <a
              href="{{ url_for('users.detail', user_id=user.id) }}"
              style="
                color: var(--primary-color);
                text-decoration: none;
                font-size: 0.85rem;
              "
            >
              <i class="fas fa-user me-2"></i>{{ user.username }}
            </a>
            {% if not user.is_active %}
            <span class="badge bg-secondary" style="font-size: 0.7rem"
              >Inactive</span
            >
            {% endif %}
          </div>
          {% endfor %}
        </div>
        {% else %}
        <p
          style="
            color: var(--text-muted);
            font-size: 0.85rem;
            font-style: italic;
          "
        >
          No users with this role
        </p>
        {% endif %}
      </div>
      <div
        class="card-body"
        style="border-top: 1px solid var(--card-border); padding-top: 12px"
      >
        <a
          href="{{ url_for('roles.detail', role_name=role.name) }}"
          class="btn btn-sm btn-outline-primary w-100"
        >
          <i class="fas fa-eye me-2"></i>View Details
        </a>
      </div>
    </div>
  </div>
  {% endfor %}
</div>

<!-- Quick Stats -->
<div class="row mt-4">
  <div class="col-md-12">
    <div class="card">
      <div class="card-header">
        <i class="fas fa-chart-bar me-2"></i>Role Distribution
      </div>
      <div class="card-body">
        <div class="row">
          {% for role in roles %}
          <div class="col-md-4 mb-3">
            <div
              style="padding: 20px; background: var(--darker-bg); border-radius: 6px; border-left: 4px solid var(--{{ role.badge_color }}-color)"
            >
              <h6
                style="
                  color: var(--text-secondary);
                  font-size: 0.75rem;
                  text-transform: uppercase;
                  margin-bottom: 8px;
                "
              >
                {{ role.display_name }}
              </h6>
              <div
                style="
                  display: flex;
                  align-items: center;
                  justify-content: space-between;
                "
              >
                <span
                  style="
                    font-size: 2rem;
                    font-weight: 700;
                    color: var(--text-primary);
                  "
                  >{{ role.user_count }}</span
                >
                <div class="progress" style="width: 60%; height: 8px">
                  <div
                    class="progress-bar bg-{{ role.badge_color }}"
                    role="progressbar"
                    style="width: {% if roles|sum(attribute='user_count') > 0 %}{{ (role.user_count / roles|sum(attribute='user_count') * 100)|round }}{% else %}0{% endif %}%"
                    aria-valuenow="{{ role.user_count }}"
                    aria-valuemin="0"
                    aria-valuemax="{{ roles|sum(attribute='user_count') }}"
                  ></div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Info Box -->
<div class="alert alert-info mt-4" style="border-left-color: var(--info-color)">
  <i class="fas fa-info-circle me-2"></i>
  <strong>Note:</strong> Roles are system-defined and cannot be created or
  deleted. To change a user's role, go to
  <a
    href="{{ url_for('users.index') }}"
    style="color: var(--primary-color); font-weight: 600"
    >Users Management</a
  >
  and edit the user.
</div>

{% endblock %}
