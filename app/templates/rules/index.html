{% extends "layouts/base.html" %} {% block title %}Cybersecurity Rules{%
endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3">Security Rules</h1>
  {% if session.user_role in ['admin', 'analyst'] %}
  <a href="{{ url_for('rules.create') }}" class="btn btn-primary"
    >+ Create New Rule</a
  >
  {% endif %}
</div>

{% if rules %}
<div class="table-responsive">
  <table class="table table-striped table-bordered align-middle shadow-sm">
    <thead class="table-dark">
      <tr>
        <th style="width: 50px">ID</th>
        <th>Rule Name</th>
        <th>Attack Type</th>
        <th>Priority</th>
        <th>Severity</th>
        <th>Status</th>
        <th style="width: 180px">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for rule in rules %}
      <tr>
        <td>{{ rule.id }}</td>
        <td>
          <a
            href="{{ url_for('rules.detail', rule_id=rule.id) }}"
            class="text-decoration-none fw-semibold"
          >
            {{ rule.name }}
          </a>
        </td>
        <td>
          {% if rule.attack_type_id in attack_types %}
          <span class="badge bg-info"
            >{{ attack_types[rule.attack_type_id].name.replace('_', ' ').title()
            }}</span
          >
          {% endif %}
        </td>
        <td>
          {% if rule.priority == 'high' %}
          <span class="badge bg-danger">High</span>
          {% elif rule.priority == 'medium' %}
          <span class="badge bg-warning text-dark">Medium</span>
          {% else %}
          <span class="badge bg-secondary">Low</span>
          {% endif %}
        </td>
        <td><span class="badge bg-dark">{{ rule.severity_score }}/10</span></td>
        <td>
          {% if rule.is_active %}
          <span class="badge bg-success">Active</span>
          {% else %}
          <span class="badge bg-secondary">Inactive</span>
          {% endif %}
        </td>
        <td>
          <div class="btn-group" role="group">
            <a
              href="{{ url_for('rules.detail', rule_id=rule.id) }}"
              class="btn btn-sm btn-outline-info"
              title="View Details"
            >
              <i class="fas fa-eye"></i>
            </a>
            {% if session.user_role in ['admin', 'analyst'] %}
            <a
              href="{{ url_for('rules.edit', rule_id=rule.id) }}"
              class="btn btn-sm btn-outline-warning"
              title="Edit Rule"
            >
              <i class="fas fa-edit"></i>
            </a>
            <a
              href="{{ url_for('rules.delete_confirm', rule_id=rule.id) }}"
              class="btn btn-sm btn-outline-danger"
              title="Delete Rule"
            >
              <i class="fas fa-trash"></i>
            </a>
            {% endif %}
          </div>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="alert alert-info">
  <h5 class="alert-heading">No Rules Defined</h5>
  <p>
    The knowledge base is empty. Create your first rule to start detecting
    security incidents.
  </p>
  {% if session.user_role in ['admin', 'analyst'] %}
  <a href="{{ url_for('rules.create') }}" class="btn btn-primary"
    >Create First Rule</a
  >
  {% endif %}
</div>
{% endif %}

<div class="mt-4">
  <div
    class="card"
    style="border-radius: 12px; border: 1px solid var(--card-border)"
  >
    <div
      class="card-header"
      style="
        background: linear-gradient(
          135deg,
          rgba(111, 66, 193, 0.08),
          rgba(111, 66, 193, 0.03)
        );
        border-bottom: 2px solid rgba(111, 66, 193, 0.2);
        padding: 1.25rem;
        border-radius: 12px 12px 0 0;
      "
    >
      <h5 class="mb-0" style="font-weight: 600; color: var(--text-primary)">
        <i class="fas fa-chart-bar me-2" style="color: #6f42c1"></i>
        Statistics
      </h5>
    </div>
    <div class="card-body" style="padding: 2rem">
      <div class="row g-4">
        <div class="col-lg-3 col-md-6">
          <div
            style="
              padding: 24px;
              background: linear-gradient(
                135deg,
                rgba(13, 110, 253, 0.05),
                rgba(13, 110, 253, 0.02)
              );
              border-radius: 10px;
              border-left: 4px solid #0d6efd;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
          >
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h6
                style="
                  color: var(--text-secondary);
                  font-size: 0.8rem;
                  text-transform: uppercase;
                  margin: 0;
                  letter-spacing: 0.5px;
                  font-weight: 600;
                "
              >
                Total Rules
              </h6>
              <i
                class="fas fa-shield-alt"
                style="font-size: 1.2rem; color: #0d6efd; opacity: 0.6"
              ></i>
            </div>
            <div>
              <span
                style="
                  font-size: 2.5rem;
                  font-weight: 700;
                  color: var(--text-primary);
                  line-height: 1;
                "
              >
                {{ rules|length }}
              </span>
              <span
                style="
                  color: var(--text-muted);
                  font-size: 0.9rem;
                  margin-left: 6px;
                "
              >
                rule{{ rules|length != 1 and 's' or '' }}
              </span>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div
            style="
              padding: 24px;
              background: linear-gradient(
                135deg,
                rgba(25, 135, 84, 0.05),
                rgba(25, 135, 84, 0.02)
              );
              border-radius: 10px;
              border-left: 4px solid #198754;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
          >
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h6
                style="
                  color: var(--text-secondary);
                  font-size: 0.8rem;
                  text-transform: uppercase;
                  margin: 0;
                  letter-spacing: 0.5px;
                  font-weight: 600;
                "
              >
                Active Rules
              </h6>
              <i
                class="fas fa-check-circle"
                style="font-size: 1.2rem; color: #198754; opacity: 0.6"
              ></i>
            </div>
            <div>
              <span
                style="
                  font-size: 2.5rem;
                  font-weight: 700;
                  color: var(--text-primary);
                  line-height: 1;
                "
              >
                {{ rules|selectattr('is_active')|list|length }}
              </span>
              <span
                style="
                  color: var(--text-muted);
                  font-size: 0.9rem;
                  margin-left: 6px;
                "
              >
                active
              </span>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div
            style="
              padding: 24px;
              background: linear-gradient(
                135deg,
                rgba(220, 53, 69, 0.05),
                rgba(220, 53, 69, 0.02)
              );
              border-radius: 10px;
              border-left: 4px solid #dc3545;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
          >
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h6
                style="
                  color: var(--text-secondary);
                  font-size: 0.8rem;
                  text-transform: uppercase;
                  margin: 0;
                  letter-spacing: 0.5px;
                  font-weight: 600;
                "
              >
                High Priority
              </h6>
              <i
                class="fas fa-exclamation-triangle"
                style="font-size: 1.2rem; color: #dc3545; opacity: 0.6"
              ></i>
            </div>
            <div>
              <span
                style="
                  font-size: 2.5rem;
                  font-weight: 700;
                  color: var(--text-primary);
                  line-height: 1;
                "
              >
                {{ rules|selectattr('priority', 'equalto', 'high')|list|length
                }}
              </span>
              <span
                style="
                  color: var(--text-muted);
                  font-size: 0.9rem;
                  margin-left: 6px;
                "
              >
                critical
              </span>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div
            style="
              padding: 24px;
              background: linear-gradient(
                135deg,
                rgba(111, 66, 193, 0.05),
                rgba(111, 66, 193, 0.02)
              );
              border-radius: 10px;
              border-left: 4px solid #6f42c1;
              transition: all 0.3s ease;
            "
            onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 8px 16px rgba(0,0,0,0.1)';"
            onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none';"
          >
            <div class="d-flex align-items-center justify-content-between mb-3">
              <h6
                style="
                  color: var(--text-secondary);
                  font-size: 0.8rem;
                  text-transform: uppercase;
                  margin: 0;
                  letter-spacing: 0.5px;
                  font-weight: 600;
                "
              >
                Attack Types
              </h6>
              <i
                class="fas fa-bug"
                style="font-size: 1.2rem; color: #6f42c1; opacity: 0.6"
              ></i>
            </div>
            <div>
              <span
                style="
                  font-size: 2.5rem;
                  font-weight: 700;
                  color: var(--text-primary);
                  line-height: 1;
                "
              >
                {{ attack_types|length }}
              </span>
              <span
                style="
                  color: var(--text-muted);
                  font-size: 0.9rem;
                  margin-left: 6px;
                "
              >
                type{{ attack_types|length != 1 and 's' or '' }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
