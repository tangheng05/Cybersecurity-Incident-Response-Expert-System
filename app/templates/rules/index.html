{% extends "layouts/base.html" %} {% block title %}Cybersecurity Rules{%
endblock %} {% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="h3">Security Rules</h1>
  {% if session.role in ['admin', 'analyst'] %}
  <a href="{{ url_for('rules.create') }}" class="btn btn-primary"
    >+ Create New Rule</a
  >
  {% endif %}
</div>

{% if rules %}
<div class="table-responsive">
  <table class="table table-striped table-bordered align-middle shadow-sm">
    <thead class="table-dark">
      <tr>
        <th style="width: 50px">ID</th>
        <th>Rule Name</th>
        <th>Attack Type</th>
        <th>Priority</th>
        <th>Severity</th>
        <th>Status</th>
        <th style="width: 180px">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for rule in rules %}
      <tr>
        <td>{{ rule.id }}</td>
        <td>
          <a
            href="{{ url_for('rules.detail', rule_id=rule.id) }}"
            class="text-decoration-none fw-semibold"
          >
            {{ rule.name }}
          </a>
        </td>
        <td>
          {% if rule.attack_type_id in attack_types %}
          <span class="badge bg-info"
            >{{ attack_types[rule.attack_type_id].name.replace('_', ' ').title()
            }}</span
          >
          {% endif %}
        </td>
        <td>
          {% if rule.priority == 'high' %}
          <span class="badge bg-danger">High</span>
          {% elif rule.priority == 'medium' %}
          <span class="badge bg-warning text-dark">Medium</span>
          {% else %}
          <span class="badge bg-secondary">Low</span>
          {% endif %}
        </td>
        <td><span class="badge bg-dark">{{ rule.severity_score }}/10</span></td>
        <td>
          {% if rule.is_active %}
          <span class="badge bg-success">Active</span>
          {% else %}
          <span class="badge bg-secondary">Inactive</span>
          {% endif %}
        </td>
        <td>
          <a
            href="{{ url_for('rules.detail', rule_id=rule.id) }}"
            class="btn btn-sm btn-outline-info"
            title="View"
            >üëÅÔ∏è</a
          >
          {% if session.role in ['admin', 'analyst'] %}
          <a
            href="{{ url_for('rules.edit', rule_id=rule.id) }}"
            class="btn btn-sm btn-outline-secondary"
            title="Edit"
            >‚úèÔ∏è</a
          >
          {% endif %} {% if session.role == 'admin' %}
          <a
            href="{{ url_for('rules.delete_confirm', rule_id=rule.id) }}"
            class="btn btn-sm btn-outline-danger"
            title="Delete"
            >üóëÔ∏è</a
          >
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="alert alert-info">
  <h5 class="alert-heading">No Rules Defined</h5>
  <p>
    The knowledge base is empty. Create your first rule to start detecting
    security incidents.
  </p>
  {% if session.role in ['admin', 'analyst'] %}
  <a href="{{ url_for('rules.create') }}" class="btn btn-primary"
    >Create First Rule</a
  >
  {% endif %}
</div>
{% endif %}

<div class="mt-4">
  <div class="card">
    <div class="card-header bg-secondary text-white">
      <h5 class="mb-0">üìä Statistics</h5>
    </div>
    <div class="card-body">
      <div class="row text-center">
        <div class="col-md-3">
          <h3>{{ rules|length }}</h3>
          <p class="text-muted">Total Rules</p>
        </div>
        <div class="col-md-3">
          <h3>{{ rules|selectattr('is_active')|list|length }}</h3>
          <p class="text-muted">Active Rules</p>
        </div>
        <div class="col-md-3">
          <h3>
            {{ rules|selectattr('priority', 'equalto', 'high')|list|length }}
          </h3>
          <p class="text-muted">High Priority</p>
        </div>
        <div class="col-md-3">
          <h3>{{ attack_types|length }}</h3>
          <p class="text-muted">Attack Types</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
