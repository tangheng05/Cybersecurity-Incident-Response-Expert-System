{% extends "layouts/base.html" %} {% block title %}Create Rule{% endblock %} {%
block content %}
<h1 class="h3 mb-4">Create New Security Rule</h1>

<div class="card shadow-sm">
  <div class="card-body">
    <form method="POST" novalidate id="ruleForm">
      {{ form.hidden_tag() }}

      <!-- Basic Information -->
      <div class="row">
        <div class="col-md-8">
          <div class="mb-3">
            {{ form.name.label(class="form-label") }} {{
            form.name(class="form-control" + (" is-invalid" if form.name.errors
            else "")) }} {% if form.name.errors %}
            <div class="invalid-feedback">
              {% for error in form.name.errors %}{{ error }}{% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
        <div class="col-md-4">
          <div class="mb-3">
            {{ form.attack_type_id.label(class="form-label") }} {{
            form.attack_type_id(class="form-select" + (" is-invalid" if
            form.attack_type_id.errors else "")) }} {% if
            form.attack_type_id.errors %}
            <div class="invalid-feedback">
              {% for error in form.attack_type_id.errors %}{{ error }}{% endfor
              %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Symbolic Conditions -->
      <div class="mb-4">
        {{ form.symbolic_conditions.label(class="form-label fw-bold") }}
        <small class="text-muted d-block mb-2"
          >Enter symbolic facts (one per line)</small
        >
        {{ form.symbolic_conditions(class="form-control" + (" is-invalid" if
        form.symbolic_conditions.errors else "")) }} {% if
        form.symbolic_conditions.errors %}
        <div class="invalid-feedback">
          {% for error in form.symbolic_conditions.errors %}{{ error }}{% endfor
          %}
        </div>
        {% endif %}
        <small class="form-text text-muted"
          >Examples: high_failed_attempts, short_timespan, admin_target</small
        >
      </div>

      <!-- Conclusion -->
      <div class="mb-4">
        {{ form.conclusion.label(class="form-label fw-bold") }}
        <small class="text-muted d-block mb-2"
          >The attack type conclusion</small
        >
        {{ form.conclusion(class="form-control" + (" is-invalid" if
        form.conclusion.errors else "")) }} {% if form.conclusion.errors %}
        <div class="invalid-feedback">
          {% for error in form.conclusion.errors %}{{ error }}{% endfor %}
        </div>
        {% endif %}
        <small class="form-text text-muted"
          >Examples: brute_force_attack, ddos_attack, apt_attack</small
        >
      </div>

      <!-- Certainty Factor -->
      <div class="mb-4">
        {{ form.cf.label(class="form-label fw-bold") }}
        <small class="text-muted d-block mb-2"
          >Confidence level for this rule (0.0 = no confidence, 1.0 = absolute
          certainty)</small
        >
        {{ form.cf(class="form-control" + (" is-invalid" if form.cf.errors else
        "")) }} {% if form.cf.errors %}
        <div class="invalid-feedback">
          {% for error in form.cf.errors %}{{ error }}{% endfor %}
        </div>
        {% endif %}
        <small class="form-text text-muted"
          >Range: 0.0 to 1.0 (e.g., 0.85 for high confidence)</small
        >
      </div>

      <!-- Priority and Severity -->
      <div class="row">
        <div class="col-md-4">
          <div class="mb-3">
            {{ form.priority.label(class="form-label") }} {{
            form.priority(class="form-select" + (" is-invalid" if
            form.priority.errors else "")) }} {% if form.priority.errors %}
            <div class="invalid-feedback">
              {% for error in form.priority.errors %}{{ error }}{% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
        <div class="col-md-4">
          <div class="mb-3">
            {{ form.severity_score.label(class="form-label") }} {{
            form.severity_score(class="form-control" + (" is-invalid" if
            form.severity_score.errors else "")) }} {% if
            form.severity_score.errors %}
            <div class="invalid-feedback">
              {% for error in form.severity_score.errors %}{{ error }}{% endfor
              %}
            </div>
            {% endif %}
          </div>
        </div>
        <div class="col-md-4">
          <div class="mb-3 mt-4">
            <div class="form-check">
              {{ form.is_active(class="form-check-input") }} {{
              form.is_active.label(class="form-check-label") }}
            </div>
          </div>
        </div>
      </div>

      <div class="mt-4">
        {{ form.submit(class="btn btn-primary") }}
        <a href="{{ url_for('rules.index') }}" class="btn btn-outline-secondary"
          >Cancel</a
        >
      </div>
    </form>
  </div>
</div>

{% endblock %}
