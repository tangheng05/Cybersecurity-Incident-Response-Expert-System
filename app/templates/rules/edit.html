{% extends "layouts/base.html" %} {% block title %}Edit Rule{% endblock %} {%
block content %}
<h1 class="h3 mb-4">Edit Security Rule</h1>

<div class="card shadow-sm">
  <div class="card-body">
    <form method="POST" novalidate>
      {{ form.hidden_tag() }}

      <!-- Basic Information -->
      <div class="row">
        <div class="col-md-8">
          <div class="mb-3">
            {{ form.name.label(class="form-label") }} {{
            form.name(class="form-control" + (" is-invalid" if form.name.errors
            else "")) }} {% if form.name.errors %}
            <div class="invalid-feedback">
              {% for error in form.name.errors %}{{ error }}{% endfor %}
            </div>
            {% endif %}
          </div>
        </div>
        <div class="col-md-4">
          <div class="mb-3">
            {{ form.attack_type_id.label(class="form-label") }} {{
            form.attack_type_id(class="form-select" + (" is-invalid" if
            form.attack_type_id.errors else "")) }} {% if
            form.attack_type_id.errors %}
            <div class="invalid-feedback">
              {% for error in form.attack_type_id.errors %}{{ error }}{% endfor
              %}
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Symbolic Conditions -->
      <div class="mb-4">
        <label class="form-label fw-bold">Symbolic Conditions</label>
        <small class="text-muted d-block mb-2"
          >Enter symbolic facts (one per line)</small
        >
        {{ form.symbolic_conditions(class="form-control" + (" is-invalid" if
        form.symbolic_conditions.errors else ""), rows=8) }} {% if
        form.symbolic_conditions.errors %}
        <div class="invalid-feedback">
          {% for error in form.symbolic_conditions.errors %}{{ error }}{% endfor
          %}
        </div>
        {% endif %}
        <small class="form-text text-muted">
          Examples: high_failed_attempts, short_timespan, admin_target,
          extreme_traffic_rate
        </small>
      </div>

      <!-- Conclusion -->
      <div class="row">
        <div class="col-md-6">
          <div class="mb-3">
            {{ form.conclusion.label(class="form-label") }} {{
            form.conclusion(class="form-control" + (" is-invalid" if
            form.conclusion.errors else "")) }} {% if form.conclusion.errors %}
            <div class="invalid-feedback">
              {% for error in form.conclusion.errors %}{{ error }}{% endfor %}
            </div>
            {% endif %}
            <small class="form-text text-muted">
              Examples: brute_force_attack, ddos_attack, credential_stuffing,
              apt_attack
            </small>
          </div>
        </div>
        <div class="col-md-3">
          <div class="mb-3">
            {{ form.cf.label(class="form-label") }} {{
            form.cf(class="form-control" + (" is-invalid" if form.cf.errors else
            "")) }} {% if form.cf.errors %}
            <div class="invalid-feedback">
              {% for error in form.cf.errors %}{{ error }}{% endfor %}
            </div>
            {% endif %}
            <small class="form-text text-muted"
              >Value between 0.0 and 1.0</small
            >
          </div>
        </div>
        <div class="col-md-3">
          <div class="mb-3">
            <label class="form-label">&nbsp;</label>
            <div class="form-check form-switch">
              {{ form.is_active(class="form-check-input") }} {{
              form.is_active.label(class="form-check-label") }}
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex justify-content-between align-items-center mt-4">
        <a
          href="{{ url_for('rules.detail', rule_id=rule.id) }}"
          class="btn btn-secondary"
        >
          <i class="fas fa-arrow-left"></i> Cancel
        </a>
        <button type="submit" class="btn btn-primary">
          <i class="fas fa-save"></i> Update Rule
        </button>
      </div>
    </form>
  </div>
</div>

<div class="card shadow-sm mt-4">
  <div class="card-header bg-light">
    <h5 class="mb-0">V2 Forward-Chaining Engine</h5>
  </div>
  <div class="card-body">
    <p class="mb-2"><strong>How it works:</strong></p>
    <ul class="mb-0">
      <li>
        Rules fire when <strong>all</strong> symbolic conditions are present in
        the facts
      </li>
      <li>Multiple rules can support the same conclusion</li>
      <li>
        Certainty Factors (CF) combine using:
        <code>CF_new = CF_old + CF_rule Ã— (1 - CF_old)</code>
      </li>
      <li>The conclusion with highest final CF is selected</li>
    </ul>
  </div>
</div>

{% endblock %}
