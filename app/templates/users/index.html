{% extends "layouts/base.html" %} {% set active_page = "users" %} {% block
content %}

<!-- Page Header with Enhanced Design -->
<div class="mb-5">
  <div class="d-flex align-items-center justify-content-between">
    <div>
      <h1 class="h2 mb-2" style="font-weight: 700; color: var(--text-primary)">
        <i class="fas fa-users me-3" style="color: #0d6efd"></i>User Management
      </h1>
      <p class="mb-0" style="color: var(--text-secondary); font-size: 1rem">
        Manage system users, roles, and access permissions
      </p>
    </div>
    <a
      href="{{ url_for('users.create') }}"
      class="btn btn-primary"
      style="
        border-radius: 8px;
        padding: 0.65rem 1.5rem;
        font-weight: 500;
        box-shadow: 0 2px 6px rgba(13, 110, 253, 0.3);
      "
    >
      <i class="fas fa-user-plus me-2"></i>Add New User
    </a>
  </div>
</div>

<!-- Stats Overview -->
{% if users %}
<div class="row g-4 mb-4">
  <div class="col-lg-3 col-md-6">
    <div
      class="card"
      style="
        border-radius: 12px;
        border: none;
        background: linear-gradient(
          135deg,
          rgba(13, 110, 253, 0.08),
          rgba(13, 110, 253, 0.03)
        );
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      "
    >
      <div class="card-body" style="padding: 1.5rem">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <p
              class="mb-1"
              style="
                color: var(--text-secondary);
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 600;
              "
            >
              Total Users
            </p>
            <h3
              class="mb-0"
              style="font-weight: 700; color: var(--text-primary)"
            >
              {{ users|length }}
            </h3>
          </div>
          <div
            style="
              width: 50px;
              height: 50px;
              border-radius: 10px;
              background: rgba(13, 110, 253, 0.15);
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <i
              class="fas fa-users"
              style="font-size: 1.5rem; color: #0d6efd"
            ></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div
      class="card"
      style="
        border-radius: 12px;
        border: none;
        background: linear-gradient(
          135deg,
          rgba(25, 135, 84, 0.08),
          rgba(25, 135, 84, 0.03)
        );
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      "
    >
      <div class="card-body" style="padding: 1.5rem">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <p
              class="mb-1"
              style="
                color: var(--text-secondary);
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 600;
              "
            >
              Active
            </p>
            <h3
              class="mb-0"
              style="font-weight: 700; color: var(--text-primary)"
            >
              {{ users|selectattr('is_active')|list|length }}
            </h3>
          </div>
          <div
            style="
              width: 50px;
              height: 50px;
              border-radius: 10px;
              background: rgba(25, 135, 84, 0.15);
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <i
              class="fas fa-check-circle"
              style="font-size: 1.5rem; color: #198754"
            ></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div
      class="card"
      style="
        border-radius: 12px;
        border: none;
        background: linear-gradient(
          135deg,
          rgba(220, 53, 69, 0.08),
          rgba(220, 53, 69, 0.03)
        );
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      "
    >
      <div class="card-body" style="padding: 1.5rem">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <p
              class="mb-1"
              style="
                color: var(--text-secondary);
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 600;
              "
            >
              Administrators
            </p>
            <h3
              class="mb-0"
              style="font-weight: 700; color: var(--text-primary)"
            >
              {{ users|selectattr('role', 'equalto', 'admin')|list|length }}
            </h3>
          </div>
          <div
            style="
              width: 50px;
              height: 50px;
              border-radius: 10px;
              background: rgba(220, 53, 69, 0.15);
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <i
              class="fas fa-shield-alt"
              style="font-size: 1.5rem; color: #dc3545"
            ></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-3 col-md-6">
    <div
      class="card"
      style="
        border-radius: 12px;
        border: none;
        background: linear-gradient(
          135deg,
          rgba(255, 193, 7, 0.08),
          rgba(255, 193, 7, 0.03)
        );
        overflow: hidden;
        box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      "
    >
      <div class="card-body" style="padding: 1.5rem">
        <div class="d-flex align-items-center justify-content-between">
          <div>
            <p
              class="mb-1"
              style="
                color: var(--text-secondary);
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                font-weight: 600;
              "
            >
              Analysts
            </p>
            <h3
              class="mb-0"
              style="font-weight: 700; color: var(--text-primary)"
            >
              {{ users|selectattr('role', 'equalto', 'analyst')|list|length }}
            </h3>
          </div>
          <div
            style="
              width: 50px;
              height: 50px;
              border-radius: 10px;
              background: rgba(255, 193, 7, 0.15);
              display: flex;
              align-items: center;
              justify-content: center;
            "
          >
            <i
              class="fas fa-user-shield"
              style="font-size: 1.5rem; color: #ffc107"
            ></i>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Users Table Card -->
<div
  class="card"
  style="
    border-radius: 12px;
    border: none;
    background: var(--card-bg);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    overflow: hidden;
  "
>
  <div
    class="card-header"
    style="
      background: linear-gradient(
        135deg,
        rgba(13, 110, 253, 0.08),
        rgba(13, 110, 253, 0.03)
      );
      border-bottom: 2px solid rgba(13, 110, 253, 0.2);
      padding: 1.25rem 1.5rem;
      border: none;
    "
  >
    <div class="d-flex align-items-center justify-content-between">
      <h5 class="mb-0" style="font-weight: 600; color: var(--text-primary)">
        <i class="fas fa-list me-2" style="color: #0d6efd"></i>All Users
        <span class="badge bg-primary ms-2" style="font-size: 0.75rem"
          >{{ users|length }}</span
        >
      </h5>
      <div class="input-group" style="width: 300px">
        <span
          class="input-group-text"
          style="
            background: var(--darker-bg);
            border: 1px solid var(--card-border);
            border-radius: 8px 0 0 8px;
          "
        >
          <i class="fas fa-search" style="color: var(--text-secondary)"></i>
        </span>
        <input
          type="text"
          class="form-control"
          placeholder="Search users..."
          id="userSearch"
          style="
            background: var(--darker-bg);
            border: 1px solid var(--card-border);
            border-left: none;
            border-radius: 0 8px 8px 0;
          "
        />
      </div>
    </div>
  </div>
  <div class="card-body" style="padding: 0">
    <div class="table-responsive">
      <table class="table table-hover mb-0" style="border-radius: 8px">
        <thead style="background: rgba(13, 110, 253, 0.05)">
          <tr>
            <th
              style="
                border: none;
                padding: 14px 20px;
                font-weight: 600;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: var(--text-primary);
              "
            >
              #
            </th>
            <th
              style="
                border: none;
                padding: 14px 20px;
                font-weight: 600;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: var(--text-primary);
              "
            >
              User
            </th>
            <th
              style="
                border: none;
                padding: 14px 20px;
                font-weight: 600;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: var(--text-primary);
              "
            >
              Email
            </th>
            <th
              style="
                border: none;
                padding: 14px 20px;
                font-weight: 600;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: var(--text-primary);
              "
            >
              Role
            </th>
            <th
              style="
                border: none;
                padding: 14px 20px;
                font-weight: 600;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: var(--text-primary);
              "
            >
              Status
            </th>
            <th
              style="
                border: none;
                padding: 14px 20px;
                font-weight: 600;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: var(--text-primary);
              "
            >
              Created
            </th>
            <th
              style="
                border: none;
                padding: 14px 20px;
                font-weight: 600;
                font-size: 0.85rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: var(--text-primary);
                text-align: center;
              "
            >
              Actions
            </th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
          <tr style="border-bottom: 1px solid var(--card-border)">
            <td
              style="
                padding: 16px 20px;
                vertical-align: middle;
                color: var(--text-secondary);
                font-weight: 500;
              "
            >
              {{ loop.index }}
            </td>

            <td style="padding: 16px 20px; vertical-align: middle">
              <a
                href="{{ url_for('users.detail', user_id=user.id) }}"
                style="
                  text-decoration: none;
                  font-weight: 600;
                  color: #0d6efd;
                  display: flex;
                  align-items: center;
                  gap: 10px;
                  transition: color 0.2s;
                "
                onmouseover="this.style.color='#0a58ca';"
                onmouseout="this.style.color='#0d6efd';"
              >
                <div
                  style="
                    width: 36px;
                    height: 36px;
                    border-radius: 50%;
                    background: linear-gradient(
                      135deg,
                      rgba(13, 110, 253, 0.2),
                      rgba(13, 110, 253, 0.1)
                    );
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-weight: 700;
                    color: #0d6efd;
                  "
                >
                  {{ user.username[0]|upper }}
                </div>
                <span>{{ user.username }}</span>
              </a>
            </td>

            <td style="padding: 16px 20px; vertical-align: middle">
              <code
                style="
                  background: rgba(13, 110, 253, 0.1);
                  padding: 5px 10px;
                  border-radius: 6px;
                  font-size: 0.85rem;
                  color: #0d6efd;
                "
              >
                {{ user.email }}
              </code>
            </td>

            <td style="padding: 16px 20px; vertical-align: middle">
              {% if user.role == 'admin' %}
              <span
                class="badge bg-danger"
                style="
                  padding: 6px 12px;
                  border-radius: 6px;
                  font-weight: 500;
                  text-transform: uppercase;
                  font-size: 0.75rem;
                "
              >
                <i class="fas fa-shield-alt me-1"></i>{{ user.role }}
              </span>
              {% elif user.role == 'analyst' %}
              <span
                class="badge bg-warning"
                style="
                  padding: 6px 12px;
                  border-radius: 6px;
                  font-weight: 500;
                  text-transform: uppercase;
                  font-size: 0.75rem;
                "
              >
                <i class="fas fa-user-shield me-1"></i>{{ user.role }}
              </span>
              {% else %}
              <span
                class="badge bg-info"
                style="
                  padding: 6px 12px;
                  border-radius: 6px;
                  font-weight: 500;
                  text-transform: uppercase;
                  font-size: 0.75rem;
                "
              >
                <i class="fas fa-eye me-1"></i>{{ user.role }}
              </span>
              {% endif %}
            </td>

            <td style="padding: 16px 20px; vertical-align: middle">
              {% if user.is_active %}
              <span
                class="badge bg-success"
                style="
                  padding: 6px 12px;
                  border-radius: 6px;
                  font-weight: 500;
                  font-size: 0.75rem;
                "
              >
                <i class="fas fa-check-circle me-1"></i>Active
              </span>
              {% else %}
              <span
                class="badge bg-secondary"
                style="
                  padding: 6px 12px;
                  border-radius: 6px;
                  font-weight: 500;
                  font-size: 0.75rem;
                "
              >
                <i class="fas fa-times-circle me-1"></i>Inactive
              </span>
              {% endif %}
            </td>

            <td
              style="
                padding: 16px 20px;
                vertical-align: middle;
                color: var(--text-secondary);
                font-size: 0.9rem;
              "
            >
              <i
                class="fas fa-calendar-alt me-2"
                style="color: var(--text-muted)"
              ></i
              >{{ user.created_at.strftime('%Y-%m-%d') }}
            </td>

            <td
              style="
                padding: 16px 20px;
                text-align: center;
                vertical-align: middle;
              "
            >
              <div class="btn-group" role="group">
                <a
                  href="{{ url_for('users.detail', user_id=user.id) }}"
                  class="btn btn-sm btn-outline-primary"
                  style="border-radius: 6px 0 0 6px; padding: 0.4rem 0.75rem"
                  title="View Details"
                >
                  <i class="fas fa-eye"></i>
                </a>
                <a
                  href="{{ url_for('users.edit', user_id=user.id) }}"
                  class="btn btn-sm btn-outline-warning"
                  style="
                    border-radius: 0;
                    padding: 0.4rem 0.75rem;
                    border-left: none;
                    border-right: none;
                  "
                  title="Edit User"
                >
                  <i class="fas fa-edit"></i>
                </a>
                <a
                  href="{{ url_for('users.delete_confirm', user_id=user.id) }}"
                  class="btn btn-sm btn-outline-danger"
                  style="border-radius: 0 6px 6px 0; padding: 0.4rem 0.75rem"
                  title="Delete User"
                >
                  <i class="fas fa-trash-alt"></i>
                </a>
              </div>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

{% else %}
<!-- Empty State -->
<div
  class="card"
  style="
    border-radius: 12px;
    border: none;
    background: var(--card-bg);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
  "
>
  <div class="card-body" style="padding: 4rem 2rem; text-align: center">
    <div
      style="
        width: 100px;
        height: 100px;
        margin: 0 auto 24px;
        border-radius: 50%;
        background: linear-gradient(
          135deg,
          rgba(108, 117, 125, 0.1),
          rgba(108, 117, 125, 0.05)
        );
        display: flex;
        align-items: center;
        justify-content: center;
      "
    >
      <i
        class="fas fa-users"
        style="font-size: 3rem; color: var(--text-muted); opacity: 0.4"
      ></i>
    </div>
    <h4
      style="color: var(--text-primary); font-weight: 600; margin-bottom: 12px"
    >
      No Users Found
    </h4>
    <p style="color: var(--text-muted); font-size: 1rem; margin-bottom: 28px">
      Get started by creating your first user account.
    </p>
    <a
      href="{{ url_for('users.create') }}"
      class="btn btn-primary"
      style="border-radius: 8px; padding: 0.75rem 2rem; font-weight: 500"
    >
      <i class="fas fa-user-plus me-2"></i>Create First User
    </a>
  </div>
</div>
{% endif %}

<script>
  // Simple search functionality
  document
    .getElementById("userSearch")
    ?.addEventListener("input", function (e) {
      const searchTerm = e.target.value.toLowerCase();
      const rows = document.querySelectorAll("tbody tr");

      rows.forEach((row) => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? "" : "none";
      });
    });
</script>

{% endblock %}
